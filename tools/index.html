<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>미드나잇의 천문 퀴즈 (with. AI)</title>
  <style>
    body { font-family: sans-serif; background:#f7f7f7; margin:0; padding:0; }
    header { background:#111; color:#fff; padding:12px; text-align:center; font-size:20px; }
    #modeBar { display:flex; justify-content:center; gap:10px; margin:12px; }
    #modeBar button { padding:8px 14px; border-radius:6px; border:1px solid #ccc; cursor:pointer; }
    #modeBar button.primary { background:#111; color:#fff; }
    #quizBox { max-width:600px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    #choices button { display:block; width:100%; margin:6px 0; padding:10px; border-radius:6px; border:1px solid #ccc; cursor:pointer; text-align:left; }
    #choices button.correct { background:#c6f6d5; }
    #choices button.wrong { background:#fed7d7; }
    #credit { text-align:center; font-size:12px; color:#555; margin:20px; }
    img.quiz-img { max-width:100%; height:auto; display:block; margin:10px auto; }
  </style>
</head>
<body>
  <header>미드나잇의 천문 퀴즈 (with. AI)</header>
  <div id="modeBar">
    <button data-mode="random" class="primary">랜덤</button>
    <button data-mode="image">성도(이미지)</button>
    <button data-mode="constellation">별자리퀴즈</button>
    <button data-mode="solar">태양계</button>
  </div>
  <div id="quizBox">퀴즈를 선택하세요!</div>
  <div id="credit">
    Made by 미드나잇(MIDNIGHT) × ChatGPT<br/>
    <a href="https://www.youtube.com/@midnight_astro" target="_blank">Youtube 미드나잇 천체관측 channel</a><br/>
    Unauthorized reproduction or redistribution is strictly prohibited.
  </div>
  <script>
    async function fetchQuiz(mode){
      const res=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode})});
      if(!res.ok){alert("문제 불러오기 실패");return null;}
      return (await res.json()).data;
    }

    function renderQuiz(q){
      const box=document.getElementById("quizBox");
      box.innerHTML="";
      const qEl=document.createElement("div");
      qEl.textContent=q.question;
      box.appendChild(qEl);

      if(q.image){
        const img=document.createElement("img");
        img.src=q.image;
        img.className="quiz-img";
        box.appendChild(img);
        if(q.image_credit){
          const c=document.createElement("div");
          c.style="font-size:11px;color:#666;text-align:center;margin:4px;";
          c.textContent=q.image_credit;
          box.appendChild(c);
        }
      }

      const ch=document.createElement("div");
      ch.id="choices";
      q.choices.forEach((c,i)=>{
        const b=document.createElement("button");
        b.textContent=`${i+1}. ${c}`;
        b.onclick=()=>{
          if(i===q.answerIndex){b.classList.add("correct");alert("정답입니다! 🎉");}
          else {b.classList.add("wrong");alert("다시 생각해보세요 😯");}
        };
        ch.appendChild(b);
      });
      box.appendChild(ch);
    }

    document.querySelectorAll("#modeBar button[data-mode]").forEach(b=>{
      b.onclick=async()=>{
        document.querySelectorAll("#modeBar button").forEach(x=>x.classList.remove("primary"));
        b.classList.add("primary");
        const q=await fetchQuiz(b.dataset.mode);
        if(q)renderQuiz(q);
      };
    });
  </script>
</body>
</html>
